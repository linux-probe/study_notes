[TOC]



# 调度时机

调度进程的时机如下：

1. 进程主动调用`schedule()`函数。

2. 周期性的调度，抢占当前进程。

3. 唤醒进程的时候，被唤醒的进程可能抢占当前进程。

4. 创建新进程的时候，新进程可能抢占当前进程

5. 中断退出的时候

## 主动调度

用户模式下，无法直接调用`schedule()`函数，只能通过系统调用进入内核模式，如果系统调用等待某个资源，就会把进程设置为睡眠模式，然后调用`schedule()`来调度进程。

内核模式有三种主动调用模式

1. 调用`schedule()`函数
2. 调用`cond_resched()`函数，`cond_resched()`安全的地方通过明确的调用来减少延迟。
3. 等待某个资源，如互斥所，信号量，会把进程设置为睡眠状态，然后调用`schedule()`

## 周期调度

时钟中断处理程序检查当前进程的执行时间有没有超过限额，如果超过限额，设置需要重新调度标志，中断处理程序返回的时候会检查这个标志位，然后进行调度。

## 唤醒进程时抢占

1. 如果被唤醒进程和当前进程属于同一调度类，调用check_preempt_curr检查是否可以抢占

2. 如果被唤醒进程所属调度类优先级高于当前进程所属调度类优先级，那么给当前进程设置重新调度标志。

## 创建新进程时抢占

